<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>تثبيت تطبيق أيين</title>

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b7ed1">
<link rel="apple-touch-icon" href="ayn-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes"> <!-- للتوافق -->
<meta name="apple-mobile-web-app-title" content="Ayn">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
  body{font-family: "Tajawal", sans-serif;background:#f4f6f8;margin:0;padding:20px;text-align:center}
  .card{background:#fff;border-radius:16px;box-shadow:0 6px 25px rgba(0,0,0,0.08);padding:25px;max-width:420px;margin:40px auto}
  h1{margin-top:0;color:#0b7ed1}
  p{color:#444;line-height:1.6}
  .btn{display:inline-block;margin:8px;padding:12px 18px;border-radius:10px;text-decoration:none;font-weight:600;background:#0b7ed1;color:#fff;border:none;cursor:pointer}
  .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
  .modal-content{background:#fff;margin:18% auto;padding:18px;border-radius:12px;width:86%;max-width:380px;text-align:center}
  .close{background:#eee;border:none;padding:8px 12px;border-radius:8px;margin-top:10px;cursor:pointer}
</style>
</head>
<body>

<div class="card">
  <img src="ayn-180.png" alt="شعار أيين" style="width:90px;margin-bottom:15px;">
  <h1>تثبيت تطبيق أيين</h1>
  <p>اختر جهازك:</p>

  <!-- زر Android (PWA) -->
  <button id="installBtn" class="btn" style="display:none;">⬇ تثبيت على أندرويد</button>

  <!-- زر iOS يفتح المودال -->
  <button id="iosBtn" class="btn"> تثبيت على آيفون</button>
</div>

<!-- مودال iPhone -->
<div id="iosModal" class="modal">
  <div class="modal-content">
    <h3>تثبيت على آيفون</h3>
    <p>لتثبيت التطبيق على شاشة آيفون:</p>
    <ol style="text-align:right; direction:rtl;">
      <li>افتح هذه الصفحة في متصفح <strong>Safari</strong>.</li>
      <li>اضغط زر <strong>المشاركة (Share)</strong>.</li>
      <li>اختر <strong>Add to Home Screen</strong> ثم اضغط <strong>Add</strong>.</li>
    </ol>
    <button class="close">إغلاق</button>
  </div>
</div>

<script>
/* ============================
   تسجيل Service Worker (PWA)
============================ */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(()=>console.log('SW registered'))
    .catch(e=>console.warn('SW failed', e));
}

/* ============================
   زر iOS - فتح/اغلاق المودال
============================ */
const modal = document.getElementById('iosModal');
document.getElementById('iosBtn').onclick = () => modal.style.display = 'block';
document.querySelector('.close').onclick = () => modal.style.display = 'none';
window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

/* ============================
   زر Android - إضافة PWA
============================ */
let deferredPrompt;
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); // منع الإظهار التلقائي
  deferredPrompt = e;
  installBtn.style.display = 'inline-block'; // إظهار الزر
});

installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt(); // عرض نافذة التثبيت
    const { outcome } = await deferredPrompt.userChoice;
    console.log('User choice:', outcome); // accepted أو dismissed
    deferredPrompt = null;
    installBtn.style.display = 'none'; // إخفاء الزر بعد المحاولة
  } else {
    alert('هذه الصفحة لا يمكن تثبيتها كاختصار حالياً. استخدم متصفح Chrome أو Edge على Android.');
  }
});
</script>

</body>
</html>
