<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠÙŠÙ†</title>

<!-- Ø±ÙˆØ§Ø¨Ø· Ù†Ø³Ø¨ÙŠØ© (ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯) -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b7ed1">
<link rel="apple-touch-icon" href="ayn-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Ayn">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
  body{font-family: "Tajawal", sans-serif;background:#f4f6f8;margin:0;padding:20px;text-align:center}
  .card{background:#fff;border-radius:16px;box-shadow:0 6px 25px rgba(0,0,0,0.08);padding:25px;max-width:420px;margin:40px auto}
  h1{margin-top:0;color:#0b7ed1}
  p{color:#444;line-height:1.6}
  .btn{display:inline-block;margin:8px;padding:12px 18px;border-radius:10px;text-decoration:none;font-weight:600;background:#0b7ed1;color:#fff;border:none;cursor:pointer; transition: background-color 0.2s;}
  .btn:hover { background-color: #0968b3; }
  .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
  .modal-content{background:#fff;margin:18% auto;padding:18px;border-radius:12px;width:86%;max-width:380px;text-align:center}
  .close{background:#eee;border:none;padding:8px 12px;border-radius:8px;margin-top:10px;cursor:pointer}
  #status { margin-top: 15px; font-weight: 600; color: #28a745; }
</style>
</head>
<body>

<div class="card">
  <img src="ayn-180.png" alt="Ø´Ø¹Ø§Ø± Ø£ÙŠÙŠÙ†" style="width:90px;margin-bottom:15px;">
  <h1>ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠÙŠÙ†</h1>
  <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© Ø¹Ø¨Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</p>

  <!-- Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (Ø³ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡/Ø¥Ø®ÙØ§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript) -->
  <button id="installBtn" class="btn" style="display: none;">ğŸ¤– ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

  <!-- Ø²Ø± iOS (Ø³ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ø¢ÙŠÙÙˆÙ†) -->
  <button id="iosBtn" class="btn" style="display: none;">ï£¿ ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø¢ÙŠÙÙˆÙ†</button>

  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
  <div id="status"></div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ iPhone -->
<div id="iosModal" class="modal">
  <div class="modal-content">
    <h3>ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø¢ÙŠÙÙˆÙ†</h3>
    <p>Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ø¢ÙŠÙÙˆÙ†:</p>
    <ol style="text-align:right; direction:rtl;">
      <li>Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ù…ØªØµÙØ­ <strong>Safari</strong>.</li>
      <li>Ø§Ø¶ØºØ· Ø²Ø± <strong>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (Share)</strong>.</li>
      <li>Ø§Ø®ØªØ± <strong>Add to Home Screen</strong> Ø«Ù… Ø§Ø¶ØºØ· <strong>Add</strong>.</li>
    </ol>
    <button class="close">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
/* ============================
   ØªØ³Ø¬ÙŠÙ„ Service Worker
   ============================ */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker registered successfully.'))
    .catch(e => console.warn('Service Worker registration failed:', e));
}

/* ============================
   Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (PWA)
   ============================ */

let deferredPrompt; // Ù„ØªØ®Ø²ÙŠÙ† Ø­Ø¯Ø« Ø§Ù„ØªØ«Ø¨ÙŠØª
const installBtn = document.getElementById('installBtn');
const iosBtn = document.getElementById('iosBtn');
const iosModal = document.getElementById('iosModal');
const statusDiv = document.getElementById('status');

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());

if (isIos) {
  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¢ÙŠÙÙˆÙ†ØŒ Ø£Ø¸Ù‡Ø± Ø²Ø± Ø§Ù„Ø¢ÙŠÙÙˆÙ†
  iosBtn.style.display = 'inline-block';
} else {
  // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¢ÙŠÙÙˆÙ†ØŒ Ø§Ø³ØªÙ…Ø¹ Ù„Ø­Ø¯Ø« Ø§Ù„ØªØ«Ø¨ÙŠØª
  window.addEventListener('beforeinstallprompt', (e) => {
    // Ù…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    e.preventDefault();
    // Ø­ÙØ¸ Ø§Ù„Ø­Ø¯Ø« Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§
    deferredPrompt = e;
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø®ØµØµ
    installBtn.style.display = 'inline-block';
  });

  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) {
      return;
    }
    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø·Ø§Ù„Ø¨Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª
    deferredPrompt.prompt();
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ù„Ø£Ù†Ù‡ Ù„Ø§ ÙŠØ¬Ø¨ Ø¹Ø±Ø¶Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
    installBtn.style.display = 'none';
    // Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const { outcome } = await deferredPrompt.userChoice;
    console.log(`User response to the install prompt: ${outcome}`);
    
    if (outcome === 'accepted') {
      statusDiv.textContent = 'Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ! ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­.';
    } else {
      statusDiv.textContent = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª.';
    }
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ø­ÙÙˆØ¸
    deferredPrompt = null;
  });
}

/* ============================
   Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¢ÙŠÙÙˆÙ†
   ============================ */
iosBtn.onclick = () => iosModal.style.display = 'block';
document.querySelector('.close').onclick = () => iosModal.style.display = 'none';
window.onclick = e => { if (e.target === iosModal) iosModal.style.display = 'none'; };

</script>

</body>
</html>
